function C = C_computation(q, dq, params,masses)

g=9.81;

% Manipulator params
m1 = masses(1);
m2 = masses(2);
m3 = masses(3);
m4 = masses(4);

q1 = q(1);
q2 = q(2);
q3 = q(3);
q4 = q(4);

dq1 = dq(1);
dq2 = dq(2);
dq3 = dq(3);
dq4 = dq(4);

a1=params(1);
a2=params(2);
a3=params(3);
a4=params(4);

C= [- (a2^2*dq2*m2*sin(2*q2))/6 - (a2^2*dq2*m3*sin(2*q2))/2 - (a2^2*dq2*m4*sin(2*q2))/2 - (a4^2*dq2*m4*sin(2*q2 + 2*q3 + 2*q4))/6 - (a4^2*dq3*m4*sin(2*q2 + 2*q3 + 2*q4))/6 - (a4^2*dq4*m4*sin(2*q2 + 2*q3 + 2*q4))/6 - (a3^2*dq2*m3*sin(2*q2 + 2*q3))/6 - (a3^2*dq2*m4*sin(2*q2 + 2*q3))/2 - (a3^2*dq3*m3*sin(2*q2 + 2*q3))/6 - (a3^2*dq3*m4*sin(2*q2 + 2*q3))/2 - (a2*a3*dq2*m3*sin(2*q2 + q3))/2 - a2*a3*dq2*m4*sin(2*q2 + q3) - (a2*a3*dq3*m3*sin(2*q2 + q3))/4 - (a2*a3*dq3*m4*sin(2*q2 + q3))/2 - (a1*a4*dq2*m4*sin(q2 + q3 + q4))/2 - (a1*a4*dq3*m4*sin(q2 + q3 + q4))/2 - (a1*a4*dq4*m4*sin(q2 + q3 + q4))/2 - (a2*a4*dq2*m4*sin(2*q2 + q3 + q4))/2 - (a2*a4*dq3*m4*sin(2*q2 + q3 + q4))/4 - (a2*a4*dq4*m4*sin(2*q2 + q3 + q4))/4 - (a1*a3*dq2*m3*sin(q2 + q3))/2 - a1*a3*dq2*m4*sin(q2 + q3) - (a1*a3*dq3*m3*sin(q2 + q3))/2 - a1*a3*dq3*m4*sin(q2 + q3) - (a2*a4*dq3*m4*sin(q3 + q4))/4 - (a2*a4*dq4*m4*sin(q3 + q4))/4 - (a1*a2*dq2*m2*sin(q2))/2 - a1*a2*dq2*m3*sin(q2) - a1*a2*dq2*m4*sin(q2) - (a2*a3*dq3*m3*sin(q3))/4 - (a2*a3*dq3*m4*sin(q3))/2 - (a3*a4*dq4*m4*sin(q4))/4 - (a3*a4*dq2*m4*sin(2*q2 + 2*q3 + q4))/2 - (a3*a4*dq3*m4*sin(2*q2 + 2*q3 + q4))/2 - (a3*a4*dq4*m4*sin(2*q2 + 2*q3 + q4))/4, -dq1*((a3^2*m3*sin(2*q2 + 2*q3))/6 + (a3^2*m4*sin(2*q2 + 2*q3))/2 + (a2^2*m2*sin(2*q2))/6 + (a2^2*m3*sin(2*q2))/2 + (a2^2*m4*sin(2*q2))/2 + (a4^2*m4*sin(2*q2 + 2*q3 + 2*q4))/6 + (a2*a4*m4*sin(2*q2 + q3 + q4))/2 + (a1*a3*m3*sin(q2 + q3))/2 + a1*a3*m4*sin(q2 + q3) + (a1*a2*m2*sin(q2))/2 + a1*a2*m3*sin(q2) + a1*a2*m4*sin(q2) + (a3*a4*m4*sin(2*q2 + 2*q3 + q4))/2 + (a2*a3*m3*sin(2*q2 + q3))/2 + a2*a3*m4*sin(2*q2 + q3) + (a1*a4*m4*sin(q2 + q3 + q4))/2), -dq1*((a3^2*m3*sin(2*q2 + 2*q3))/6 + (a3^2*m4*sin(2*q2 + 2*q3))/2 + (a4^2*m4*sin(2*q2 + 2*q3 + 2*q4))/6 + (a2*a4*m4*sin(2*q2 + q3 + q4))/4 + (a1*a3*m3*sin(q2 + q3))/2 + a1*a3*m4*sin(q2 + q3) + (a2*a4*m4*sin(q3 + q4))/4 + (a2*a3*m3*sin(q3))/4 + (a2*a3*m4*sin(q3))/2 + (a3*a4*m4*sin(2*q2 + 2*q3 + q4))/2 + (a2*a3*m3*sin(2*q2 + q3))/4 + (a2*a3*m4*sin(2*q2 + q3))/2 + (a1*a4*m4*sin(q2 + q3 + q4))/2), -(a4*dq1*m4*(2*a4*sin(2*q2 + 2*q3 + 2*q4) + 3*a2*sin(2*q2 + q3 + q4) + 3*a2*sin(q3 + q4) + 3*a3*sin(q4) + 3*a3*sin(2*q2 + 2*q3 + q4) + 6*a1*sin(q2 + q3 + q4)))/12;
    dq1*((a3^2*m3*sin(2*q2 + 2*q3))/6 + (a3^2*m4*sin(2*q2 + 2*q3))/2 + (a2^2*m2*sin(2*q2))/6 + (a2^2*m3*sin(2*q2))/2 + (a2^2*m4*sin(2*q2))/2 + (a4^2*m4*sin(2*q2 + 2*q3 + 2*q4))/6 + (a2*a4*m4*sin(2*q2 + q3 + q4))/2 + (a1*a3*m3*sin(q2 + q3))/2 + a1*a3*m4*sin(q2 + q3) + (a1*a2*m2*sin(q2))/2 + a1*a2*m3*sin(q2) + a1*a2*m4*sin(q2) + (a3*a4*m4*sin(2*q2 + 2*q3 + q4))/2 + (a2*a3*m3*sin(2*q2 + q3))/2 + a2*a3*m4*sin(2*q2 + q3) + (a1*a4*m4*sin(q2 + q3 + q4))/2),                                                                                                                                                                                                                                                                                                                               - dq3*((a2*a4*m4*sin(q3 + q4))/2 + (a2*a3*m3*sin(q3))/2 + a2*a3*m4*sin(q3)) - dq4*((a2*a4*m4*sin(q3 + q4))/2 + (a3*a4*m4*sin(q4))/2),                                                                                                                                                                                                                      - (a2*dq2*(a3*m3*sin(q3) + 2*a3*m4*sin(q3) + a4*m4*sin(q3 + q4)))/2 - (a2*dq3*(a3*m3*sin(q3) + 2*a3*m4*sin(q3) + a4*m4*sin(q3 + q4)))/2 - (a4*dq4*m4*(a2*sin(q3 + q4) + a3*sin(q4)))/2,                                                                                                        -(a4*m4*(a2*sin(q3 + q4) + a3*sin(q4))*(dq2 + dq3 + dq4))/2;
    dq1*((a3^2*m3*sin(2*q2 + 2*q3))/6 + (a3^2*m4*sin(2*q2 + 2*q3))/2 + (a4^2*m4*sin(2*q2 + 2*q3 + 2*q4))/6 + (a2*a4*m4*sin(2*q2 + q3 + q4))/4 + (a1*a3*m3*sin(q2 + q3))/2 + a1*a3*m4*sin(q2 + q3) + (a2*a4*m4*sin(q3 + q4))/4 + (a2*a3*m3*sin(q3))/4 + (a2*a3*m4*sin(q3))/2 + (a3*a4*m4*sin(2*q2 + 2*q3 + q4))/2 + (a2*a3*m3*sin(2*q2 + q3))/4 + (a2*a3*m4*sin(2*q2 + q3))/2 + (a1*a4*m4*sin(q2 + q3 + q4))/2),                                                                                                                                                                                                                                                                                                                                                               dq2*((a2*a4*m4*sin(q3 + q4))/2 + (a2*a3*m3*sin(q3))/2 + a2*a3*m4*sin(q3)) - (a3*a4*dq4*m4*sin(q4))/2,                                                                                                                                                                                                                                                                                                                                                                                   -(a3*a4*dq4*m4*sin(q4))/2,                                                                                                                            -(a3*a4*m4*sin(q4)*(dq2 + dq3 + dq4))/2;
    (a4*dq1*m4*(2*a4*sin(2*q2 + 2*q3 + 2*q4) + 3*a2*sin(2*q2 + q3 + q4) + 3*a2*sin(q3 + q4) + 3*a3*sin(q4) + 3*a3*sin(2*q2 + 2*q3 + q4) + 6*a1*sin(q2 + q3 + q4)))/12,                                                                                                                                                                                                                                                                                                                                                                                  dq2*((a2*a4*m4*sin(q3 + q4))/2 + (a3*a4*m4*sin(q4))/2) + (a3*a4*dq3*m4*sin(q4))/2,                                                                                                                                                                                                                                                                                                                                                                            (a3*a4*m4*sin(q4)*(dq2 + dq3))/2,                                                                                                                                                                  0];
